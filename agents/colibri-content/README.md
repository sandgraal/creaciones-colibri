# Colibrí Content Agent

> Builds and deploys the Eleventy storefront whenever site content or templates change.

## Overview
- **Identifier:** `colibri-content`
- **Status:** active
- **Primary Trigger:** Pushes to `main` via `.github/workflows/pages.yml`
- **Owner:** Engineering & Content

## Responsibilities
- Run `npm run build` to translate catalog data and regenerate the Eleventy site output (`_site-eleventy/`).
- Ensure Markdown, Nunjucks templates, and data files stay in sync across English and Spanish locales (`docs/operations/localization.md`).
- Publish static assets (CSS, JS, manifests) required by the storefront while respecting the GitHub Pages `pathPrefix` configuration.
- Surface build failures quickly so copy or data regressions are caught before deployment (`docs/development-handbook.md`).

## Workflows
- **Production deploy:** `.github/workflows/pages.yml` checks out the repository, installs dependencies, runs `npm run build`, and uploads `_site-eleventy/` as the Pages artifact.
- **Manual dry run:** Trigger the `AI Agents` workflow (`ai/.github/workflows/agents.yml`) with `agent=colibri-content` for a smoke build without publishing.
- **Local verification:** `npm run start` for iterative development with Eleventy’s dev server.

## Configuration
- **Environment variables:**
  - `SNIPCART_PUBLIC_KEY` *(required)* — enables cart components in templates.
  - `SITE_URL`, `FORMSPREE_ENDPOINT`, `NEWSLETTER_ACTION` *(optional but recommended)* — keep metadata, forms, and canonical URLs accurate.
  - `PLAUSIBLE_DOMAIN` *(optional)* — injects Plausible analytics when approved (`docs/operations/analytics-plan.md`).
- **Data sources:** Product catalog lives in `src/_data/products.js` with machine translations generated by `scripts/translate-products.js`.
- **Secrets management:** Follow `docs/operations/secrets-management.md` when rotating credentials.

## Observability
- **GitHub Actions logs:** Review the `Build` job in `.github/workflows/pages.yml` for Eleventy or translation errors.
- **AI agent log:** When executed through `ai/.github/workflows/agents.yml`, results append to `ai/logs/agent-run.log` for traceability.
- **Manual QA:** Run `npm run audit:assets` or Lighthouse per `docs/operations/performance-audit.md` after large content drops.

## Runbook
1. **Kick off a rebuild:**
   - Push changes to `main` or trigger `AI Agents → colibri-content` for manual verification.
2. **Investigate failures:**
   - Pull the latest commit locally, run `npm run build`, and inspect Eleventy error output.
   - Validate data translations via `node scripts/translate-products.js` if locale mismatches appear.
3. **Rollback:**
   - Revert the offending commit or redeploy the previous Pages artifact following `docs/operations/deployment-runbook.md`.
4. **Post-fix verification:**
   - Confirm home, products, bundles, and blog pages load in both locales and that Snipcart widgets render when keys are set.

## Change History
| Date | Change | Author |
|------|--------|--------|
| 2025-10-24 | Initial agent documentation and AI workflow integration | Automation Team |

---

*Based on `agents/README.template.md`; update when triggers, owners, or configuration change.*
