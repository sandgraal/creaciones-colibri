{% set defaultLocale = site.locale | default('en') %}
{% set currentLocale = locale | default(defaultLocale) %}
{% set translations = collections.i18n and collections.i18n[0].data.i18n %}
{% set localeStrings = translations and translations[currentLocale] %}
{% if localeStrings == null and translations and translations['en'] %}
  {% set localeStrings = translations['en'] %}
{% endif %}
{% set fallbackStrings = translations and translations['en'] %}
{% set productCardStrings = localeStrings and localeStrings.ui and localeStrings.ui.productCard %}
{% if (productCardStrings == null or productCardStrings == undefined) and fallbackStrings %}
  {% set productCardStrings = fallbackStrings.ui and fallbackStrings.ui.productCard %}
{% endif %}
{% set productCardStrings = productCardStrings or {} %}
{% set categoryLabel = productCardStrings.categoryLabel or 'Category' %}
{% set dietaryLabel = productCardStrings.dietaryLabel or 'Dietary' %}
{% set addToCartLabel = productCardStrings.addToCart or 'Add to cart' %}
{% set viewDetailsLabel = productCardStrings.viewDetails or 'View details' %}
{% set productUrl = product.url %}
{% if not productUrl %}
  {% if currentLocale == 'es' %}
    {% set productUrl = '/es/productos/' ~ product.id ~ '/' %}
  {% else %}
    {% set productUrl = '/products/' ~ product.id ~ '/' %}
  {% endif %}
{% endif %}

<article class="product-card">
  <a class="product-card__link" href="{{ productUrl | url }}">
    <div class="product-card__media">
      {% if product.image.src | isSvg %}
        <img src="{{ product.image.src | url }}" alt="{{ product.image.alt }}" loading="lazy" decoding="async">
      {% else %}
        {% responsiveImage product.image.src, product.image.alt, 'product-card__image' %}
      {% endif %}
    </div>
    <div class="product-card__content">
      {% if product.labels and product.labels | length %}
        <ul class="product-card__labels">
          {% for label in product.labels %}
            <li class="product-card__label">{{ label }}</li>
          {% endfor %}
        </ul>
      {% endif %}
      <h3 class="product-card__title">{{ product.name }}</h3>
      <p class="product-card__summary">{{ product.shortDescription }}</p>
      <dl class="product-card__meta">
        <div class="product-card__meta-row">
          <dt>{{ categoryLabel }}</dt>
          <dd>{{ product.category }}</dd>
        </div>
        {% if product.dietary and product.dietary | length %}
          <div class="product-card__meta-row">
            <dt>{{ dietaryLabel }}</dt>
            <dd>{{ product.dietary | join(', ') }}</dd>
          </div>
        {% endif %}
      </dl>
    </div>
  </a>
  <div class="product-card__footer">
    <div class="product-card__price">
      <span class="product-card__amount">${{ product.price }}</span>
      <span class="product-card__unit">{{ product.unit }}</span>
    </div>
    {% if site.snipcart.publicKey %}
      <button
        class="button button-primary product-card__cart snipcart-add-item"
        type="button"
        data-item-id="{{ product.id }}"
        data-item-name="{{ product.name }}"
        data-item-price="{{ product.price }}"
        data-item-url="{{ productUrl | url }}"
        data-item-description="{{ product.shortDescription }}"
        data-item-image="{{ product.image.src | url }}"
        data-item-quantity="1">{{ addToCartLabel }}</button>
    {% else %}
      <a class="button button-secondary product-card__cart" href="{{ productUrl | url }}">{{ viewDetailsLabel }}</a>
    {% endif %}
  </div>
</article>
