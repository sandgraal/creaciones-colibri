<!DOCTYPE html>
{% set defaultLocale = site.locale | default('en') %}
{% set currentLocale = locale | default(defaultLocale) %}
{% set localePrefix = '' %}
{% if currentLocale != defaultLocale and currentLocale != 'en' %}
  {% set localePrefix = '/' ~ currentLocale %}
{% endif %}
{% set visionPath = localePrefix ~ '/#vision' %}
{% set newsletterPath = localePrefix ~ '/#newsletter' %}
{% set translations = null %}
{% if collections.i18n and collections.i18n | length > 0 %}
  {% set translations = collections.i18n[0].data.i18n %}
{% endif %}
{% set localeStrings = null %}
{% if translations %}
  {% set localeStrings = translations[currentLocale] %}
{% endif %}
{% if localeStrings == null and translations and translations[defaultLocale] %}
  {% set localeStrings = translations[defaultLocale] %}
{% endif %}
{% if localeStrings == null and translations and translations['en'] %}
  {% set localeStrings = translations['en'] %}
{% endif %}
{% set fallbackStrings = null %}
{% if translations %}
  {% set fallbackStrings = translations['en'] %}
{% endif %}
{% set uiStrings = null %}
{% if localeStrings and localeStrings.ui %}
  {% set uiStrings = localeStrings.ui %}
{% endif %}
{% if uiStrings == null and fallbackStrings and fallbackStrings.ui %}
  {% set uiStrings = fallbackStrings.ui %}
{% endif %}
{% set fallbackUi = null %}
{% if fallbackStrings and fallbackStrings.ui %}
  {% set fallbackUi = fallbackStrings.ui %}
{% endif %}
{% set navStrings = null %}
{% if uiStrings and uiStrings.nav %}
  {% set navStrings = uiStrings.nav %}
{% endif %}
{% if navStrings == null and fallbackUi and fallbackUi.nav %}
  {% set navStrings = fallbackUi.nav %}
{% endif %}
{% set footerStrings = null %}
{% if uiStrings and uiStrings.footer %}
  {% set footerStrings = uiStrings.footer %}
{% endif %}
{% if footerStrings == null and fallbackUi and fallbackUi.footer %}
  {% set footerStrings = fallbackUi.footer %}
{% endif %}
{% if footerStrings == null %}
  {% set footerStrings = {} %}
{% endif %}
{% set footerLegalLabel = footerStrings.legalLabel | default('Legal') %}
{% set footerLinks = footerStrings.links | default({}) %}
{% set footerPrivacyLabel = footerLinks.privacy | default('Privacy Policy') %}
{% set cartStrings = null %}
{% if uiStrings and uiStrings.cart %}
  {% set cartStrings = uiStrings.cart %}
{% endif %}
{% if cartStrings == null and fallbackUi and fallbackUi.cart %}
  {% set cartStrings = fallbackUi.cart %}
{% endif %}
{% set brandStrings = null %}
{% if uiStrings and uiStrings.brand %}
  {% set brandStrings = uiStrings.brand %}
{% endif %}
{% if brandStrings == null and fallbackUi and fallbackUi.brand %}
  {% set brandStrings = fallbackUi.brand %}
{% endif %}
{% set localeSwitcherStrings = null %}
{% if uiStrings and uiStrings.localeSwitcher %}
  {% set localeSwitcherStrings = uiStrings.localeSwitcher %}
{% endif %}
{% if localeSwitcherStrings == null and fallbackUi and fallbackUi.localeSwitcher %}
  {% set localeSwitcherStrings = fallbackUi.localeSwitcher %}
{% endif %}
{% set skipLinkStrings = null %}
{% if uiStrings and uiStrings.skipLink %}
  {% set skipLinkStrings = uiStrings.skipLink %}
{% endif %}
{% if skipLinkStrings == null and fallbackUi and fallbackUi.skipLink %}
  {% set skipLinkStrings = fallbackUi.skipLink %}
{% endif %}
{% set skipLinkLabel = skipLinkStrings and skipLinkStrings.label or 'Skip to main content' %}
{% set navVisionLabel = navStrings.vision | default('Our Vision') %}
{% set navProductsLabel = navStrings.products | default('Products') %}
{% set navBundlesLabel = navStrings.bundles | default('Bundles') %}
{% set navNewsletterLabel = navStrings.newsletter | default('Stay in Touch') %}
{% set navContactLabel = navStrings.contact | default('Contact') %}
{% set navBlogLabel = navStrings.blog | default('Blog') %}
{% set cartLabel = cartStrings and cartStrings.label or 'Cart' %}
{% set cartAriaStrings = cartStrings and cartStrings.aria or {} %}
{% set cartAriaEmpty = cartAriaStrings.empty | default(cartLabel ~ ' (empty)') %}
{% set cartAriaOne = cartAriaStrings.one | default(cartLabel ~ ' (1 item)') %}
{% set cartAriaMany = cartAriaStrings.other | default(cartLabel ~ ' (%count% items)') %}
{% set brandAlt = brandStrings.alt | default('Creaciones Colibrí logo') %}
{% set footerTagline = footerStrings.tagline | default('Crafted in Florida & Costa Rica with love for the hummingbird and the people we serve.') %}
{% set footerNote = footerStrings.note | default('© Creaciones Colibrí') %}
{% set localeSwitcherLabel = localeSwitcherStrings.ariaLabel | default('Language selector') %}
{% if currentLocale == 'es' %}
  {% set productsPath = '/es/productos/' %}
  {% set bundlesPath = '/es/suscripciones/' %}
  {% set blogPath = '/es/blog/' %}
  {% set contactPath = '/es/contacto/' %}
  {% set privacyPath = '/es/privacidad/' %}
{% else %}
  {% set productsPath = '/products/' %}
  {% set bundlesPath = '/bundles/' %}
  {% set blogPath = '/blog/' %}
  {% set contactPath = '/contact/' %}
  {% set privacyPath = '/privacy/' %}
{% endif %}
{% set homePath = '/' %}
{% if localePrefix != '' %}
  {% set homePath = localePrefix ~ '/' %}
{% endif %}
{% set pageUrl = page and page.url or '/' %}
{% if pageUrl and not pageUrl.endsWith('/') %}
  {% set pageUrl = pageUrl ~ '/' %}
{% endif %}
{% set isHomeActive = pageUrl == homePath %}
{% set isProductsActive = pageUrl.startsWith(productsPath) %}
{% set isBundlesActive = pageUrl.startsWith(bundlesPath) %}
{% set isBlogActive = pageUrl.startsWith(blogPath) %}
{% set isContactActive = pageUrl.startsWith(contactPath) %}
{% set localeLinksMap = localeLinks %}
{% set snipcartLocaleMap = site.snipcart and site.snipcart.localeMap or {} %}
{% set snipcartDefaultLanguage = site.snipcart and site.snipcart.defaultLanguage or 'en' %}
{% set snipcartTargetLanguage = snipcartLocaleMap[currentLocale] or snipcartDefaultLanguage %}
{% if snipcartTargetLanguage %}
  {% set snipcartTargetLanguage = snipcartTargetLanguage | trim %}
{% endif %}
{% set snipcartShouldSetLocale = snipcartTargetLanguage and (snipcartTargetLanguage | lower) != 'auto' %}
{% set siteMeta = siteMeta %}
{% set siteMetaTranslations = siteMeta.translations %}
{% set metaLocale = null %}
{% if siteMetaTranslations %}
  {% set metaLocale = siteMetaTranslations[currentLocale] %}
  {% if metaLocale == null and siteMetaTranslations[defaultLocale] %}
    {% set metaLocale = siteMetaTranslations[defaultLocale] %}
  {% endif %}
{% endif %}
{% set baseTitle = siteMeta.title | default('') %}
{% if metaLocale and metaLocale.title %}
  {% set baseTitle = metaLocale.title %}
{% endif %}
{% set defaultDescription = siteMeta.description %}
{% if metaLocale and metaLocale.description %}
  {% set defaultDescription = metaLocale.description %}
{% endif %}
{% set localizedTitle = baseTitle %}
{% if not localizedTitle %}
  {% set localizedTitle = siteMeta.title | default('Creaciones Colibrí') %}
{% endif %}
{% set localizedDescription = defaultDescription %}
{% if not localizedDescription %}
  {% set localizedDescription = siteMeta.description | default('') %}
{% endif %}
{% set metaTitle = localizedTitle %}
{% if title %}
  {% if localizedTitle %}
    {% set metaTitle = title ~ ' · ' ~ localizedTitle %}
  {% else %}
    {% set metaTitle = title %}
  {% endif %}
{% endif %}
{% set metaDescription = description | default(localizedDescription) %}
{% set metaImage = socialImage %}
{% set metaImageAlt = socialImageAlt %}
{% if not metaImage and image %}
  {% set metaImage = image %}
{% endif %}
{% if not metaImage and meta and meta.image %}
  {% set metaImage = meta.image %}
{% endif %}
{% if not metaImage and productData and productData.image and productData.image.src %}
  {% set metaImage = productData.image.src %}
  {% if productData.image.alt %}
    {% set metaImageAlt = productData.image.alt %}
  {% endif %}
{% endif %}
{% if not metaImage %}
  {% set metaImage = siteMeta.socialImage %}
{% endif %}
{% if not metaImageAlt %}
  {% set metaImageAlt = siteMeta.socialImageAlt or localizedTitle %}
{% endif %}
{% set metaImageAbsolute = metaImage | url | absoluteUrl(siteMeta.url) %}
{% set pageTags = [] %}
{% if tags %}
  {% if tags is string %}
    {% set pageTags = [tags] %}
  {% else %}
    {% set pageTags = tags %}
  {% endif %}
{% endif %}
{% set bundleData = bundle %}
{% if bundleData == null and baseBundle %}
  {% set bundleData = baseBundle %}
{% endif %}
{% set productData = product %}
{% if productData == null and bundleData %}
  {% set productData = bundleData %}
{% endif %}
{% if productData and productData.translations and productData.translations[currentLocale] %}
  {% set productTranslation = productData.translations[currentLocale] %}
  {% set localizedProductData = productData | merge({
    'name': productTranslation.name or productData.name,
    'shortDescription': productTranslation.shortDescription or productData.shortDescription,
    'description': productTranslation.description or productData.description,
    'unit': productTranslation.unit or productData.unit,
    'perks': productTranslation.perks or productData.perks
  }) %}
  {% set productData = localizedProductData %}
{% endif %}
{% set ogType = 'website' %}
{% if 'post' in pageTags %}
  {% set ogType = 'article' %}
{% elseif 'product' in pageTags %}
  {% set ogType = 'product' %}
{% elseif bundleData %}
  {% set ogType = 'product' %}
{% endif %}
{% set canonicalUrl = '' %}
{% if siteMeta.url %}
  {% set canonicalUrl = page.url | url | absoluteUrl(siteMeta.url) %}
{% endif %}
{% set schemaLanguage = 'en-US' %}
{% if currentLocale == 'es' %}
  {% set schemaLanguage = 'es-CR' %}
{% endif %}
{% set analyticsEnabled = site.analytics and site.analytics.enabled %}
{% set analyticsDomain = analyticsEnabled and site.analytics.plausibleDomain %}
<html lang="{{ currentLocale }}"{% if analyticsDomain %} data-analytics-domain="{{ analyticsDomain }}"{% endif %}>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ metaTitle }}</title>
    <meta name="description" content="{{ metaDescription }}">
    <meta name="theme-color" content="#f16745">
    <meta name="application-name" content="{{ localizedTitle }}">
    {% if canonicalUrl %}
      <link rel="canonical" href="{{ canonicalUrl }}">
      <meta property="og:url" content="{{ canonicalUrl }}">
    {% endif %}
    {% if siteMeta.url and site.alternateLocales %}
      <link rel="alternate" hreflang="x-default" href="{{ '/' | absoluteUrl(siteMeta.url) }}">
      {% for localeCode in site.alternateLocales %}
        {% if localeCode == site.locale or localeCode == 'en' %}
          {% set localePath = '/' %}
        {% else %}
          {% set localePath = '/' ~ localeCode ~ '/' %}
        {% endif %}
        <link rel="alternate" hreflang="{{ localeCode }}" href="{{ localePath | absoluteUrl(siteMeta.url) }}">
      {% endfor %}
    {% endif %}
    {% set ogLocale = 'en_US' %}
    {% if currentLocale == 'es' %}
      {% set ogLocale = 'es_CR' %}
    {% endif %}
    <meta property="og:title" content="{{ metaTitle }}">
    <meta property="og:description" content="{{ metaDescription }}">
    <meta property="og:site_name" content="{{ localizedTitle }}">
    <meta property="og:type" content="{{ ogType }}">
    <meta property="og:locale" content="{{ ogLocale }}">
    {% if site.alternateLocales and site.alternateLocales | length %}
      {% for localeCode in site.alternateLocales %}
        {% if localeCode != currentLocale %}
          {% set altLocale = 'en_US' %}
          {% if localeCode == 'es' %}
            {% set altLocale = 'es_CR' %}
          {% endif %}
          <meta property="og:locale:alternate" content="{{ altLocale }}">
        {% endif %}
      {% endfor %}
    {% endif %}
    <meta property="og:image" content="{{ metaImageAbsolute }}">
    <meta property="og:image:alt" content="{{ metaImageAlt }}">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ metaTitle }}">
    <meta name="twitter:description" content="{{ metaDescription }}">
    <meta name="twitter:image" content="{{ metaImageAbsolute }}">
    <meta name="twitter:image:alt" content="{{ metaImageAlt }}">
    {% if ogType == 'article' and page.date %}
      <meta property="article:published_time" content="{{ page.date | date('iso') }}">
      {% if updated %}
        <meta property="article:modified_time" content="{{ updated | date('iso') }}">
      {% endif %}
    {% endif %}
    {% if ogType == 'product' and productData %}
      <meta property="product:price:amount" content="{{ productData.price }}">
      <meta property="product:price:currency" content="{{ site.snipcart.currency }}">
    {% endif %}
    <link rel="icon" type="image/svg+xml" href="{{ '/img/branding/creaciones-colibri-logo.svg' | url }}">
    <link rel="icon" type="image/svg+xml" sizes="any" href="{{ '/img/branding/maskable-icon.svg' | url }}">
    <link rel="apple-touch-icon" type="image/svg+xml" href="{{ '/img/branding/maskable-icon.svg' | url }}">
    {% if currentLocale == 'es' %}
      <link rel="manifest" href="{{ '/es/site.webmanifest' | url }}">
    {% else %}
      <link rel="manifest" href="{{ '/site.webmanifest' | url }}">
    {% endif %}
    <link rel="mask-icon" href="{{ '/img/branding/maskable-icon.svg' | url }}" color="#f16745">
    <meta name="msapplication-TileColor" content="#f16745">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@400;600&family=Work+Sans:wght@300;400;500&display=swap"
      rel="stylesheet">
    <link rel="stylesheet" href="{{ '/css/main.css' | url }}">
    {% if analytics and analyticsEnabled %}
      {{ analytics() | safe }}
      <script defer src="{{ '/js/analytics.js' | url }}"></script>
    {% endif %}
    {% if site.snipcart.publicKey %}
      <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.33/default/snipcart.css">
    {% endif %}
    {% set organization = siteMeta.organization or {} %}
    {% set organizationUrl = organization.url or siteMeta.url %}
    {% if organizationUrl %}
      {% set organizationUrl = organizationUrl | absoluteUrl(siteMeta.url) %}
    {% endif %}
    {% set organizationLogo = (organization.logo or siteMeta.socialImage) | url | absoluteUrl(siteMeta.url) %}
    {% set organizationSameAs = organization.sameAs or [] %}
    {% set publisher = {
      '@type': 'Organization',
      'name': organization.name or localizedTitle,
      'legalName': organization.legalName,
      'url': organizationUrl,
      'logo': {
        '@type': 'ImageObject',
        'url': organizationLogo
      }
    } %}
    {% if organizationSameAs | length %}
      {% set publisher = publisher | merge({ 'sameAs': organizationSameAs }) %}
    {% endif %}
    {% if organization.contactEmail %}
      {% set publisher = publisher | merge({
        'contactPoint': [{
          '@type': 'ContactPoint',
          'email': organization.contactEmail,
          'contactType': 'customer support',
          'availableLanguage': ['en', 'es']
        }]
      }) %}
    {% endif %}
    {% set websiteUrl = canonicalUrl or siteMeta.url %}
    {% if websiteUrl %}
      {% set websiteSchema = {
        '@context': 'https://schema.org',
        '@type': 'WebSite',
        'name': localizedTitle,
        'url': websiteUrl,
        'description': metaDescription,
        'inLanguage': schemaLanguage,
        'publisher': publisher
      } %}
      <script type="application/ld+json">
        {{ websiteSchema | json | safe }}
      </script>
    {% endif %}
    {% if ogType == 'article' and page.date %}
      {% set articleUrl = canonicalUrl or siteMeta.url %}
      {% set articlePublished = page.date | date('iso') %}
      {% set articleUpdated = updated | date('iso') if updated else articlePublished %}
      {% set articleSchema = {
        '@context': 'https://schema.org',
        '@type': 'BlogPosting',
        'headline': title or metaTitle,
        'description': metaDescription,
        'image': [metaImageAbsolute],
        'datePublished': articlePublished,
        'dateModified': articleUpdated,
        'inLanguage': schemaLanguage,
        'author': {
          '@type': 'Person',
          'name': 'Creaciones Colibrí'
        },
        'publisher': publisher,
        'mainEntityOfPage': {
          '@type': 'WebPage',
          '@id': articleUrl
        }
      } %}
      <script type="application/ld+json">
        {{ articleSchema | json | safe }}
      </script>
    {% endif %}
{% if ogType == 'product' and productData %}
  {% set productUrl = canonicalUrl or siteMeta.url %}
  {% set productSchema = {
    '@context': 'https://schema.org',
    '@type': 'Product',
    'name': productData.name,
    'description': productData.description or productData.shortDescription,
    'image': [metaImageAbsolute],
    'sku': productData.id,
    'brand': {
      '@type': 'Brand',
      'name': publisher.name
    },
    'offers': {
      '@type': 'Offer',
      'priceCurrency': site.snipcart.currency,
      'price': productData.price,
      'availability': 'https://schema.org/InStock',
      'itemCondition': 'https://schema.org/NewCondition',
      'url': productUrl
    }
  } %}
  {% if bundleData and bundleData.type == 'subscription' and bundleData.billing %}
    {% set billingData = bundleData.billing %}
    {% set billingInterval = billingData.interval or '' %}
    {% set billingIntervalCount = billingData.intervalCount or 1 %}
    {% set offerDescription = productSchema.offers.description or '' %}
    {% if billingInterval %}
      {% if offerDescription %}
        {% set offerDescription = offerDescription ~ ' ' %}
      {% endif %}
      {% set offerDescription = offerDescription ~ 'Billed every ' ~ billingIntervalCount ~ ' ' ~ billingInterval %}
    {% endif %}
    {% set offersWithSubscription = productSchema.offers | merge({
      'description': offerDescription | trim
    }) %}
    {% set productSchema = productSchema | merge({ 'offers': offersWithSubscription }) %}
  {% endif %}
  {% if productData.dietary and productData.dietary | length %}
    {% set productSchema = productSchema | merge({ 'keywords': productData.dietary | join(', ') }) %}
  {% endif %}
  <script type="application/ld+json">
    {{ productSchema | json | safe }}
  </script>
{% endif %}
  </head>
  <body class="site">
    <a class="skip-link" href="#main-content">{{ skipLinkLabel }}</a>
    <header class="site-header">
      <a class="brand" href="{{ homePath | url }}"{% if isHomeActive %} aria-current="page"{% endif %}>
        <img
          class="brand-logo"
          src="{{ '/img/branding/creaciones-colibri-logo.svg' | url }}"
          alt="{{ brandAlt }}"
        >
        <span class="brand-title">Creaciones Colibrí</span>
      </a>
      <nav class="site-nav">
        <a class="nav-link" href="{{ visionPath | url }}">{{ navVisionLabel }}</a>
        <a class="nav-link" href="{{ productsPath | url }}"{% if isProductsActive %} aria-current="page"{% endif %}>{{ navProductsLabel }}</a>
        <a class="nav-link" href="{{ bundlesPath | url }}"{% if isBundlesActive %} aria-current="page"{% endif %}>{{ navBundlesLabel }}</a>
        <a class="nav-link" href="{{ blogPath | url }}"{% if isBlogActive %} aria-current="page"{% endif %}>{{ navBlogLabel }}</a>
        <a class="nav-link" href="{{ newsletterPath | url }}">{{ navNewsletterLabel }}</a>
        <a class="nav-link" href="{{ contactPath | url }}"{% if isContactActive %} aria-current="page"{% endif %}>{{ navContactLabel }}</a>
        {% if site.alternateLocales and site.alternateLocales | length %}
          <div class="locale-switcher" role="navigation" aria-label="{{ localeSwitcherLabel }}">
            {% for localeCode in site.alternateLocales %}
              {% set alternateHref = localeLinksMap[localeCode] %}
              {% if localeCode != currentLocale and alternateHref %}
                <a class="locale-switcher__link" href="{{ alternateHref | url }}" hreflang="{{ localeCode }}">{{ localeCode | upper }}</a>
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
        {% if site.snipcart.publicKey %}
          <button
            class="cart-button snipcart-checkout"
            type="button"
            data-cart-button
            data-cart-empty-label="{{ cartAriaEmpty }}"
            data-cart-one-label="{{ cartAriaOne }}"
            data-cart-many-label="{{ cartAriaMany }}"
            aria-label="{{ cartAriaEmpty }}">
            <span class="cart-button__label">{{ cartLabel }}</span>
            <span class="cart-button__count snipcart-items-count" aria-live="polite" aria-atomic="true">0</span>
          </button>
        {% endif %}
      </nav>
    </header>
    <main id="main-content" class="site-main">
      {{ content | safe }}
    </main>
    <footer class="site-footer">
      <p>{{ footerTagline }}</p>
      <div class="site-footer__meta">
        <p class="footer-note">{{ footerNote }}</p>
        <nav class="footer-links" aria-label="{{ footerLegalLabel }}">
          <a class="footer-link" href="{{ privacyPath | url }}">{{ footerPrivacyLabel }}</a>
        </nav>
      </div>
    </footer>
    {% if search %}
      <script defer src="{{ '/js/vendor/fuse.min.js' | url }}"></script>
      <script defer src="{{ '/js/search.js' | url }}"></script>
    {% endif %}
    {% if site.snipcart.publicKey %}
      <script>
        document.addEventListener("click", function(event) {
          const button = event.target.closest(".snipcart-add-item[data-quantity-input]");
          if (!button) return;
          const inputId = button.getAttribute("data-quantity-input");
          const quantityInput = document.getElementById(inputId);
          if (!quantityInput) return;
          const quantity = parseInt(quantityInput.value, 10);
          if (!Number.isFinite(quantity) || quantity <= 0) {
            button.setAttribute("data-item-quantity", "1");
            return;
          }
          button.setAttribute("data-item-quantity", quantity.toString());
        });
      </script>
      <script>
        (function() {
          var cartButton = document.querySelector('[data-cart-button]');
          if (!cartButton) {
            return;
          }

          var countElement = cartButton.querySelector('.snipcart-items-count');
          if (!countElement) {
            return;
          }

          var emptyLabel = cartButton.getAttribute('data-cart-empty-label') || cartButton.getAttribute('aria-label') || '';
          var oneLabel = cartButton.getAttribute('data-cart-one-label') || emptyLabel;
          var manyLabel = cartButton.getAttribute('data-cart-many-label') || oneLabel;

          var formatLabel = function(template, count) {
            if (!template) {
              return '';
            }

            return template.replace('%count%', count);
          };

          var updateLabel = function() {
            var text = (countElement.textContent || '').trim();
            var count = parseInt(text, 10);

            if (isNaN(count) || count <= 0) {
              cartButton.setAttribute('aria-label', emptyLabel);
              return;
            }

            if (count === 1) {
              cartButton.setAttribute('aria-label', formatLabel(oneLabel, count));
            } else {
              cartButton.setAttribute('aria-label', formatLabel(manyLabel, count));
            }
          };

          updateLabel();

          if (typeof MutationObserver === 'function') {
            var observer = new MutationObserver(updateLabel);
            observer.observe(countElement, { characterData: true, childList: true, subtree: true });
          } else {
            ['snipcart.ready', 'snipcart.cart.confirmed', 'snipcart.cart.closed', 'snipcart.cart.opened'].forEach(function(eventName) {
              document.addEventListener(eventName, updateLabel);
            });
          }
        })();
      </script>
      <script>
        (function() {
          var currentLocale = "{{ currentLocale }}";
          var defaultLanguage = {{ snipcartDefaultLanguage | default('') | dump | safe }};
          var localeMap = {{ site.snipcart.localeMap | default({}) | dump | safe }};

          if (typeof localeMap !== "object" || localeMap === null) {
            localeMap = {};
          }

          var targetLanguage = {{ snipcartTargetLanguage | default('') | dump | safe }};
          if (typeof targetLanguage === "string") {
            targetLanguage = targetLanguage.trim();
          }

          if (!targetLanguage) {
            var resolvedDefault = typeof defaultLanguage === "string" ? defaultLanguage.trim() : "";
            targetLanguage = localeMap[currentLocale] || resolvedDefault;
            if (typeof targetLanguage === "string") {
              targetLanguage = targetLanguage.trim();
            }
          }

          if (!targetLanguage || targetLanguage === "auto") {
            return;
          }

          var applyLanguage = function() {
            if (!window.Snipcart || !window.Snipcart.api || !window.Snipcart.api.session) {
              return;
            }

            try {
              window.Snipcart.api.session.setLanguage(targetLanguage);
            } catch (error) {
              console.warn("Unable to sync Snipcart language", error);
            }
          };

          if (window.Snipcart && window.Snipcart.ready) {
            window.Snipcart.ready.then(applyLanguage);
          } else {
            document.addEventListener("snipcart.ready", applyLanguage, { once: true });
          }
        })();
      </script>
      <script async src="https://cdn.snipcart.com/themes/v3.0.33/default/snipcart.js"></script>
      <div
        hidden
        id="snipcart"
        data-api-key="{{ site.snipcart.publicKey }}"
        data-currency="{{ site.snipcart.currency }}"
        {% if snipcartShouldSetLocale %}data-config-locale="{{ snipcartTargetLanguage }}"{% endif %}></div>
    {% endif %}
  </body>
</html>
